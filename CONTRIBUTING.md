# 贡献指南（Contributing Guide）

感谢您对OPA技术文档项目的关注！我们欢迎各种形式的贡献。

---

## 📋 目录

- [贡献指南（Contributing Guide）](#贡献指南contributing-guide)
  - [📋 目录](#-目录)
  - [🤝 贡献方式](#-贡献方式)
    - [1. 报告问题](#1-报告问题)
    - [2. 改进现有文档](#2-改进现有文档)
    - [3. 新增文档](#3-新增文档)
  - [📝 文档规范](#-文档规范)
    - [文件结构](#文件结构)
    - [Markdown 规范](#markdown-规范)
      - [标题层级](#标题层级)
      - [代码块](#代码块)
      - [强调格式](#强调格式)
      - [列表](#列表)
      - [表格](#表格)
      - [链接](#链接)
    - [术语规范](#术语规范)
    - [代码示例规范](#代码示例规范)
      - [Rego 代码](#rego-代码)
      - [命令示例](#命令示例)
  - [🔄 提交流程](#-提交流程)
    - [1. Fork 项目](#1-fork-项目)
    - [2. 克隆到本地](#2-克隆到本地)
    - [3. 创建分支](#3-创建分支)
    - [4. 进行修改](#4-进行修改)
    - [5. 提交变更](#5-提交变更)
    - [6. 推送分支](#6-推送分支)
    - [7. 创建 Pull Request](#7-创建-pull-request)
  - [💻 代码示例](#-代码示例)
    - [完整性要求](#完整性要求)
    - [示例模板](#示例模板)
  - [✅ 审核标准](#-审核标准)
    - [内容质量](#内容质量)
    - [格式规范](#格式规范)
    - [文档结构](#文档结构)
    - [示例代码](#示例代码)
  - [📊 文档更新优先级](#-文档更新优先级)
    - [高优先级](#高优先级)
    - [中优先级](#中优先级)
    - [低优先级](#低优先级)
  - [📞 联系方式](#-联系方式)
  - [🎯 行为准则](#-行为准则)
    - [我们的承诺](#我们的承诺)
    - [不可接受的行为](#不可接受的行为)
    - [执行](#执行)
  - [🙏 致谢](#-致谢)


---

## 🤝 贡献方式

### 1. 报告问题

如果您发现文档中的错误或不清楚的地方：

- 在 [Issues](https://github.com/your-repo/opa/issues) 中创建新问题
- 清楚描述问题所在位置和具体内容
- 如有可能，建议修正方案

**Issue 标题示例**：

```text
[文档错误] 02.1-Rego语法规范.md 第123行语法错误
[改进建议] 增加ABAC完整实现案例
[疑问] 03.4-Top-Down求值器.md 统一算法描述不清
```

### 2. 改进现有文档

- 修正错别字、格式问题
- 补充遗漏的内容
- 优化表达和示例
- 更新过时信息

### 3. 新增文档

如果您想新增文档，请先：

1. 在 Issues 中提出建议，说明文档主题和大纲
2. 等待维护者反馈，确认是否符合项目方向
3. 开始编写，并在 PR 中说明新增内容的价值

---

## 📝 文档规范

### 文件结构

每篇文档应包含：

```markdown
# 文档标题（中英文）

> **更新日期**: YYYY年MM月DD日  
> **关键词**: 关键词1、关键词2、关键词3  
> **难度**: ⭐⭐⭐  
> **预计阅读时间**: XX分钟

---

## 目录

[自动生成的目录]

## 1. 概述

[简要介绍本文档的主题和覆盖范围]

## 2. 核心内容

[详细的技术内容]

---

**相关文档**：
- [相关文档1](../路径/文档.md)
- [相关文档2](../路径/文档.md)

**参考资源**：
- 官方文档链接
- 相关技术文章
```

### Markdown 规范

#### 标题层级

```markdown
# H1 - 文档标题（每个文档只有一个）
## H2 - 主要章节
### H3 - 次级章节
#### H4 - 详细说明
```

#### 代码块

````markdown
```rego
# Rego 代码
allow if {
    input.user == "admin"
}
```

```bash
# Shell 命令
opa eval -d policy.rego "data.authz.allow"
```

```json
{
  "comment": "JSON 数据"
}
```
````

#### 强调格式

```markdown
- **粗体**: 重要概念、关键词
- *斜体*: 引用、术语首次出现
- `代码`: 代码片段、文件名、命令
```

#### 列表

```markdown
有序列表：
1. 第一步
2. 第二步
3. 第三步

无序列表：
- 要点一
- 要点二
  - 子要点
```

#### 表格

```markdown
| 列1 | 列2 | 列3 |
|-----|-----|-----|
| 内容1 | 内容2 | 内容3 |
```

#### 链接

```markdown
# 外部链接
[OPA官方文档](https://www.openpolicyagent.org/docs/)

# 内部文档链接
[相关章节](./01-技术规范/01.1-API规范.md)

# 锚点链接
[跳转到章节](#核心内容)
```

### 术语规范

| 术语 | 正确用法 | 错误用法 |
|------|---------|---------|
| OPA | Open Policy Agent (首次) / OPA | opa / Opa |
| Rego | Rego语言 | rego / REGO |
| Kubernetes | Kubernetes / K8s | k8s / kubernetes |
| RBAC | RBAC / 基于角色的访问控制 | Rbac / rbac |
| API | API / 应用程序接口 | api / Api |

### 代码示例规范

#### Rego 代码

```rego
# ✅ 好的示例：有注释、结构清晰
package authz

import future.keywords.if

# 允许管理员访问所有资源
allow if {
    input.user.role == "admin"
}

# 允许用户访问自己的资源
allow if {
    input.user.id == input.resource.owner
}
```

```rego
# ❌ 不好的示例：无注释、不清晰
package authz
allow{input.user.role=="admin"}
allow{input.user.id==input.resource.owner}
```

#### 命令示例

```bash
# ✅ 好的示例：有说明、有输出
# 启动OPA服务器
opa run --server --addr :8181

# 输出:
# {"level":"info","msg":"Starting server","time":"..."}
```

---

## 🔄 提交流程

### 1. Fork 项目

点击右上角 "Fork" 按钮，创建您的副本。

### 2. 克隆到本地

```bash
git clone https://github.com/your-username/opa.git
cd opa
```

### 3. 创建分支

```bash
# 功能分支
git checkout -b feature/new-document

# 修复分支
git checkout -b fix/typo-in-readme

# 改进分支
git checkout -b improve/api-spec-examples
```

### 4. 进行修改

- 遵循文档规范编写内容
- 确保所有链接有效
- 测试代码示例的正确性

### 5. 提交变更

```bash
git add .
git commit -m "docs: 新增ABAC访问控制案例"
```

**Commit 消息规范**：

```text
<类型>: <简短描述>

<详细描述>（可选）

<关闭的Issue>（可选）
```

**类型标签**：

- `docs`: 文档新增或修改
- `fix`: 修复错误
- `improve`: 改进现有内容
- `refactor`: 重构文档结构
- `style`: 格式调整（不改变内容）

**示例**：

```bash
docs: 新增05.3-合规性检查文档

详细说明：
- 添加完整的合规性检查场景
- 包含OPA、GDPR、HIPAA示例
- 提供自动化检查脚本

Closes #42
```

### 6. 推送分支

```bash
git push origin feature/new-document
```

### 7. 创建 Pull Request

- 在 GitHub 上点击 "New Pull Request"
- 填写 PR 模板（描述、变更内容、相关Issue）
- 等待审核反馈

---

## 💻 代码示例

### 完整性要求

每个代码示例应该：

1. **可运行**: 能够直接复制粘贴执行
2. **有注释**: 说明关键步骤和逻辑
3. **有输出**: 展示预期结果
4. **有上下文**: 说明使用场景

### 示例模板

````markdown
**场景**: 用户访问文档系统

**数据模型**:
```json
{
  "users": {
    "alice": {"role": "admin"},
    "bob": {"role": "user"}
  }
}
```

**策略**:
```rego
package docauth

import future.keywords.if

# 管理员可以访问所有文档
allow if {
    input.user.role == "admin"
}
```

**测试**:
```bash
opa eval -d policy.rego -i input.json "data.docauth.allow"
```

**输出**:
```json
{
  "result": [{"expressions": [{"value": true}]}]
}
```
````

---

## ✅ 审核标准

您的 PR 将根据以下标准审核：

### 内容质量

- [ ] 技术准确性：内容正确，无误导
- [ ] 完整性：覆盖主题的核心要点
- [ ] 清晰性：表达清楚，易于理解
- [ ] 实用性：提供可用的示例和建议

### 格式规范

- [ ] Markdown 格式正确
- [ ] 代码块语法高亮标记正确
- [ ] 链接有效且格式统一
- [ ] 图表清晰（如有）

### 文档结构

- [ ] 标题层级合理
- [ ] 章节组织清晰
- [ ] 交叉引用完整
- [ ] 目录自动生成（建议）

### 示例代码

- [ ] 代码可运行
- [ ] 有充分注释
- [ ] 遵循最佳实践
- [ ] 展示预期输出

---

## 📊 文档更新优先级

### 高优先级

- 修正技术错误
- 补充缺失的重要内容
- 更新过时的信息（版本、API等）
- 修复损坏的链接

### 中优先级

- 改进现有示例
- 增加实战案例
- 优化文档结构
- 补充形式化证明

### 低优先级

- 格式美化
- 措辞优化
- 增加图表
- 翻译其他语言

---

## 📞 联系方式

- **问题讨论**: [GitHub Issues](https://github.com/your-repo/opa/issues)
- **功能建议**: [GitHub Discussions](https://github.com/your-repo/opa/discussions)
- **紧急问题**: 发送邮件至 <maintainer@example.com>

---

## 🎯 行为准则

### 我们的承诺

为了营造开放和友好的环境，我们承诺：

- 尊重不同的观点和经验
- 优雅地接受建设性批评
- 关注对社区最有利的事情
- 对其他社区成员表示同理心

### 不可接受的行为

- 使用性别化语言或图像
- 侮辱或贬低性评论
- 公开或私下骚扰
- 未经许可发布他人私人信息
- 其他不道德或不专业的行为

### 执行

违反行为准则的行为可以向项目维护者报告。所有投诉都将被审查和调查。

---

## 🙏 致谢

感谢所有为本项目做出贡献的人！

您的每一次贡献都让这个文档体系变得更好 🎉

---

**最后更新**: 2025年10月21日  
**维护者**: OPA技术文档团队
