# å¤§è§„æ¨¡éƒ¨ç½²æ¶æ„

> **æ–‡æ¡£ç±»å‹**: ç†è®ºå®è·µæ¡¥æ¢  
> **æ ¸å¿ƒä¸»é¢˜**: OPAå¤§è§„æ¨¡ç”Ÿäº§éƒ¨ç½²æ¶æ„è®¾è®¡ä¸å®è·µ  
> **é€‚ç”¨è¯»è€…**: ç³»ç»Ÿæ¶æ„å¸ˆã€SREã€DevOpså·¥ç¨‹å¸ˆ  
> **å…ˆä¿®çŸ¥è¯†**: [éƒ¨ç½²æ¶æ„](../03-å®ç°æ¶æ„/03.1-éƒ¨ç½²æ¶æ„.md)ã€[Kubernetesé›†æˆ](../07-é›†æˆæŒ‡å—/07.4-Kubernetesé›†æˆ.md)  
> **æœ€åæ›´æ–°**: 2025å¹´10æœˆ23æ—¥  
> **æ–‡æ¡£çŠ¶æ€**: âœ… Phase 4.3 - ç†è®ºå®è·µ  
> **å®è·µä»·å€¼**: æ„å»ºé«˜å¯ç”¨ã€å¯æ‰©å±•çš„OPAéƒ¨ç½²

---

## ğŸ¯ æ–‡æ¡£ç›®æ ‡

æœ¬æ–‡æ¡£å°†**åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º**åº”ç”¨äº**OPAå¤§è§„æ¨¡éƒ¨ç½²**ï¼Œå¸®åŠ©æ¶æ„å¸ˆè®¾è®¡ç”Ÿäº§çº§OPAåŸºç¡€è®¾æ–½ã€‚

**æ ¸å¿ƒå†…å®¹**:

- é«˜å¯ç”¨æ¶æ„è®¾è®¡
- æ°´å¹³æ‰©å±•ç­–ç•¥
- æ•°æ®ä¸€è‡´æ€§ä¿è¯
- æ•…éšœæ¢å¤æœºåˆ¶
- æ€§èƒ½ä¼˜åŒ–å®è·µ

**å­¦ä¹ ä»·å€¼**:

- ğŸ—ï¸ è®¾è®¡ä¼ä¸šçº§OPAæ¶æ„
- ğŸš€ æ”¯æ’‘å¤§è§„æ¨¡æµé‡
- ğŸ›¡ï¸ ç¡®ä¿é«˜å¯ç”¨æ€§
- ğŸ“ˆ å®ç°å¼¹æ€§ä¼¸ç¼©

---

## ç›®å½•

[TOCå†…å®¹å°†åœ¨åç»­ç‰ˆæœ¬è¡¥å……å®Œæ•´ï¼ŒåŒ…å«10å¤§ç« èŠ‚ï¼Œé¢„è®¡æ€»é•¿åº¦1,800è¡Œ]

## 1. æ¶æ„è®¾è®¡åŸåˆ™

### 1.1 é«˜å¯ç”¨æ€§

**å¤šå¯ç”¨åŒºéƒ¨ç½²**:

```yaml
# Kuberneteså¤šAZéƒ¨ç½²
apiVersion: apps/v1
kind: Deployment
metadata:
  name: opa
spec:
  replicas: 9  # æ¯ä¸ªAZ 3ä¸ªå‰¯æœ¬
  template:
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app: opa
            topologyKey: topology.kubernetes.io/zone
```

### 1.2 å¯æ‰©å±•æ€§

**æ°´å¹³æ‰©å±• vs å‚ç›´æ‰©å±•**:

| ç»´åº¦ | æ°´å¹³æ‰©å±• | å‚ç›´æ‰©å±• |
|------|---------|---------|
| å®¹é‡ä¸Šé™ | ç†è®ºæ— é™ | å•æœºé™åˆ¶ |
| æˆæœ¬ | çº¿æ€§å¢é•¿ | æŒ‡æ•°å¢é•¿ |
| å¯ç”¨æ€§ | é«˜ | ä¸­ |
| å¤æ‚åº¦ | é«˜ | ä½ |
| **æ¨è** | âœ… | âš ï¸ |

---

## 2. éƒ¨ç½²æ¨¡å¼

### 2.1 Sidecaræ¨¡å¼

**Kubernetes Sidecaræ³¨å…¥**:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: myapp
spec:
  containers:
  - name: app
    image: myapp:latest
    ports:
    - containerPort: 8080
  - name: opa
    image: openpolicyagent/opa:latest
    args:
    - "run"
    - "--server"
    - "--addr=localhost:8181"
    - "--config-file=/config/config.yaml"
    volumeMounts:
    - name: opa-config
      mountPath: /config
  volumes:
  - name: opa-config
    configMap:
      name: opa-config
```

**ä¼˜åŠ¿**:

- âœ… ä½å»¶è¿Ÿï¼ˆæœ¬åœ°è°ƒç”¨ï¼‰
- âœ… éš”ç¦»æ€§å¥½
- âœ… ç‹¬ç«‹å‡çº§

**åŠ£åŠ¿**:

- âš ï¸ èµ„æºå¼€é”€å¤§
- âš ï¸ Bundleé‡å¤ä¸‹è½½

### 2.2 é›†ä¸­å¼æœåŠ¡

**OPAé›†ç¾¤éƒ¨ç½²**:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Load Balancer               â”‚
â”‚  (Nginx/Envoy/AWS ALB)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ OPA-1  â”‚      â”‚ OPA-2  â”‚
   â”‚ Pod    â”‚      â”‚ Pod    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Bundle Service â”‚
        â”‚  (S3/OCI)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**:

- âœ… èµ„æºåˆ©ç”¨ç‡é«˜
- âœ… ç»Ÿä¸€ç®¡ç†
- âœ… æ˜“äºç›‘æ§

**åŠ£åŠ¿**:

- âš ï¸ ç½‘ç»œå»¶è¿Ÿ
- âš ï¸ å•ç‚¹æ•…éšœé£é™©

---

## 3. æ•°æ®åˆ†å‘

### 3.1 Bundleç®¡ç†

**å¤šå±‚Bundleåˆ†å‘**:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Policy Repository (Git)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 1. Git Push
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CI/CD Pipeline                      â”‚
â”‚  - Build Bundle                      â”‚
â”‚  - Run Tests                         â”‚
â”‚  - Sign Bundle                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 2. Upload
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bundle Registry (S3/OCI)            â”‚
â”‚  - versioned bundles                 â”‚
â”‚  - signature verification            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 3. Pull
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPA Cluster                         â”‚
â”‚  - Auto-update bundles               â”‚
â”‚  - Verify signatures                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ•°æ®ä¸€è‡´æ€§

**æœ€ç»ˆä¸€è‡´æ€§æ¨¡å‹**:

```yaml
# Bundleé…ç½®
bundles:
  authz:
    service: bundle_service
    resource: bundles/authz.tar.gz
    signing:
      keyid: my_key
      scope: write
    polling:
      min_delay_seconds: 60   # æœ€å¿«60ç§’æ›´æ–°
      max_delay_seconds: 120  # æœ€æ…¢120ç§’æ›´æ–°
```

**ä¸€è‡´æ€§ä¿è¯**:

- ğŸ¯ æœ€ç»ˆä¸€è‡´æ€§ï¼ˆ60-120ç§’ï¼‰
- âœ… ç­¾åéªŒè¯ï¼ˆé˜²ç¯¡æ”¹ï¼‰
- âœ… ç‰ˆæœ¬åŒ–ï¼ˆå¯å›æ»šï¼‰

---

## 4. é«˜å¯ç”¨æ¶æ„

### 4.1 å¤šå‰¯æœ¬éƒ¨ç½²

**Kubernetes HPA**:

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: opa-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: opa
  minReplicas: 5
  maxReplicas: 100
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  - type: Pods
    pods:
      metric:
        name: http_request_duration_p99_milliseconds
      target:
        type: AverageValue
        averageValue: "50"
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300  # 5åˆ†é’Ÿç¨³å®šæœŸ
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
      - type: Percent
        value: 100
        periodSeconds: 30
```

### 4.2 å¥åº·æ£€æŸ¥

**Liveness & Readiness Probes**:

```yaml
spec:
  containers:
  - name: opa
    livenessProbe:
      httpGet:
        path: /health
        port: 8181
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
    readinessProbe:
      httpGet:
        path: /health?bundle=true  # æ£€æŸ¥Bundleæ˜¯å¦åŠ è½½
        port: 8181
      initialDelaySeconds: 10
      periodSeconds: 5
      timeoutSeconds: 3
      failureThreshold: 3
```

---

## 5. è´Ÿè½½å‡è¡¡

### 5.1 L7è´Ÿè½½å‡è¡¡

**Nginxé…ç½®**:

```nginx
upstream opa_backend {
    least_conn;  # æœ€å°‘è¿æ¥
    
    server opa-1.internal:8181 max_fails=3 fail_timeout=30s;
    server opa-2.internal:8181 max_fails=3 fail_timeout=30s;
    server opa-3.internal:8181 max_fails=3 fail_timeout=30s;
    
    keepalive 32;  # è¿æ¥æ± 
}

server {
    listen 80;
    
    location /v1/data/ {
        proxy_pass http://opa_backend;
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        
        # è¶…æ—¶é…ç½®
        proxy_connect_timeout 5s;
        proxy_send_timeout 10s;
        proxy_read_timeout 10s;
        
        # ç¼“å­˜é…ç½®ï¼ˆå¯¹äºå¹‚ç­‰è¯·æ±‚ï¼‰
        proxy_cache opa_cache;
        proxy_cache_valid 200 60s;
        proxy_cache_key "$request_uri";
    }
}
```

### 5.2 æœåŠ¡ç½‘æ ¼

**Istioé›†æˆ**:

```yaml
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: opa
spec:
  host: opa.default.svc.cluster.local
  trafficPolicy:
    loadBalancer:
      consistentHash:
        httpHeaderName: X-User-ID  # æŒ‰ç”¨æˆ·IDå“ˆå¸Œ
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        http1MaxPendingRequests: 1000
        http2MaxRequests: 1000
    outlierDetection:
      consecutive5xxErrors: 5
      interval: 30s
      baseEjectionTime: 30s
      maxEjectionPercent: 50
```

---

## 6. ç¾éš¾æ¢å¤

### 6.1 å¤‡ä»½ç­–ç•¥

**Bundleå¤‡ä»½**:

```bash
#!/bin/bash
# backup.sh

BACKUP_DIR="/backup/opa-bundles"
DATE=$(date +%Y%m%d-%H%M%S)

# å¤‡ä»½Bundle
aws s3 sync s3://opa-bundles/ $BACKUP_DIR/$DATE/

# ä¿ç•™æœ€è¿‘30å¤©
find $BACKUP_DIR/ -type d -mtime +30 -exec rm -rf {} \;

# éªŒè¯å¤‡ä»½
opa test $BACKUP_DIR/$DATE/*.tar.gz
```

### 6.2 æ•…éšœæ¢å¤

**è‡ªåŠ¨æ¢å¤æµç¨‹**:

```text
1. æ£€æµ‹æ•…éšœ
   â”œâ”€ å¥åº·æ£€æŸ¥å¤±è´¥
   â”œâ”€ é”™è¯¯ç‡å‘Šè­¦
   â””â”€ å»¶è¿Ÿå‘Šè­¦
   
2. è‡ªåŠ¨å“åº”
   â”œâ”€ ç§»é™¤æ•…éšœèŠ‚ç‚¹ï¼ˆK8sè‡ªåŠ¨ï¼‰
   â”œâ”€ æ‰©å®¹å¥åº·èŠ‚ç‚¹ï¼ˆHPAï¼‰
   â””â”€ é€šçŸ¥è¿ç»´å›¢é˜Ÿ
   
3. é—®é¢˜è¯Šæ–­
   â”œâ”€ æ”¶é›†æ—¥å¿—
   â”œâ”€ æ”¶é›†Profile
   â””â”€ ç”ŸæˆæŠ¥å‘Š
   
4. æ¢å¤æªæ–½
   â”œâ”€ å›æ»šBundleï¼ˆå¦‚æœæ˜¯é…ç½®é—®é¢˜ï¼‰
   â”œâ”€ é‡å¯Podï¼ˆå¦‚æœæ˜¯ä¸´æ—¶é—®é¢˜ï¼‰
   â””â”€ ä¿®å¤ä»£ç ï¼ˆå¦‚æœæ˜¯Bugï¼‰
```

---

## 7. æ€§èƒ½ä¼˜åŒ–

### 7.1 ç¼“å­˜å±‚

**å¤šçº§ç¼“å­˜æ¶æ„**:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CDN/Edge Cache (CloudFlare)       â”‚ â† L1: TTL 5m
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway Cache (Kong/Envoy)    â”‚ â† L2: TTL 1m
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPA Inter-Query Cache             â”‚ â† L3: TTL 10s
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 æŸ¥è¯¢ä¼˜åŒ–

**éƒ¨åˆ†æ±‚å€¼éƒ¨ç½²**:

```bash
# æ„å»ºä¼˜åŒ–çš„Bundle
opa build \
    --partial \
    --unknowns 'input' \
    --unknowns 'data.dynamic.*' \
    --output optimized-bundle.tar.gz \
    policies/

# éƒ¨ç½²
kubectl set image deployment/opa \
    opa=openpolicyagent/opa:latest-static

kubectl set env deployment/opa \
    OPA_BUNDLE_URL=https://bundles.example.com/optimized-bundle.tar.gz
```

---

## 8. ç›‘æ§ä¸å¯è§‚æµ‹æ€§

### 8.1 æŒ‡æ ‡ç›‘æ§

**å…³é”®SLI**:

| æŒ‡æ ‡ | SLO | ç›‘æ§æ–¹æ³• |
|------|-----|---------|
| **å¯ç”¨æ€§** | 99.95% | Uptime check |
| **å»¶è¿Ÿ P99** | < 50ms | Prometheus histogram |
| **é”™è¯¯ç‡** | < 0.1% | Error counter |
| **ååé‡** | > 10k req/s | Request rate |

**Prometheusé…ç½®**:

```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'opa'
    kubernetes_sd_configs:
    - role: pod
    relabel_configs:
    - source_labels: [__meta_kubernetes_pod_label_app]
      action: keep
      regex: opa
    - source_labels: [__meta_kubernetes_pod_name]
      target_label: pod
    - source_labels: [__meta_kubernetes_namespace]
      target_label: namespace
```

### 8.2 æ—¥å¿—èšåˆ

**Fluentdé…ç½®**:

```xml
<source>
  @type tail
  path /var/log/opa/*.log
  pos_file /var/log/opa.log.pos
  tag opa.*
  format json
</source>

<filter opa.**>
  @type parser
  key_name message
  <parse>
    @type json
  </parse>
</filter>

<match opa.**>
  @type elasticsearch
  host elasticsearch.logging.svc.cluster.local
  port 9200
  logstash_format true
  logstash_prefix opa
</match>
```

---

## 9. å®‰å…¨åŠ å›º

### 9.1 ç½‘ç»œéš”ç¦»

**NetworkPolicy**:

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: opa-netpol
spec:
  podSelector:
    matchLabels:
      app: opa
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: application
    ports:
    - protocol: TCP
      port: 8181
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: bundle-service
    ports:
    - protocol: TCP
      port: 443
```

### 9.2 è®¤è¯æˆæƒ

**mTLSé…ç½®**:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: opa
spec:
  containers:
  - name: opa
    image: openpolicyagent/opa:latest
    args:
    - "run"
    - "--server"
    - "--tls-cert-file=/certs/tls.crt"
    - "--tls-private-key-file=/certs/tls.key"
    - "--tls-ca-cert-file=/certs/ca.crt"
    - "--authentication=tls"
    - "--authorization=basic"
    volumeMounts:
    - name: certs
      mountPath: /certs
      readOnly: true
  volumes:
  - name: certs
    secret:
      secretName: opa-tls
```

---

## 10. æˆæœ¬ä¼˜åŒ–

### 10.1 èµ„æºè°ƒä¼˜

**å‚ç›´Podè‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆVPAï¼‰**:

```yaml
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: opa-vpa
spec:
  targetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: opa
  updatePolicy:
    updateMode: "Auto"
  resourcePolicy:
    containerPolicies:
    - containerName: opa
      minAllowed:
        cpu: 100m
        memory: 128Mi
      maxAllowed:
        cpu: 2000m
        memory: 2Gi
      controlledResources: ["cpu", "memory"]
```

### 10.2 å¼¹æ€§ä¼¸ç¼©

**KEDAï¼ˆäº‹ä»¶é©±åŠ¨è‡ªåŠ¨æ‰©ç¼©å®¹ï¼‰**:

```yaml
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: opa-scaledobject
spec:
  scaleTargetRef:
    name: opa
  pollingInterval: 30
  cooldownPeriod: 300
  minReplicaCount: 5
  maxReplicaCount: 100
  triggers:
  - type: prometheus
    metadata:
      serverAddress: http://prometheus:9090
      metricName: http_requests_per_second
      query: rate(http_requests_total{job="opa"}[1m])
      threshold: "1000"
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ23æ—¥  
**ç»´æŠ¤è€…**: OPAæŠ€æœ¯æ–‡æ¡£é¡¹ç›®

**ç›¸å…³é˜…è¯»**:

- [éƒ¨ç½²æ¶æ„](../03-å®ç°æ¶æ„/03.1-éƒ¨ç½²æ¶æ„.md) - æ¶æ„åŸºç¡€
- [Kubernetesé›†æˆ](../07-é›†æˆæŒ‡å—/07.4-Kubernetesé›†æˆ.md) - K8séƒ¨ç½²
- [æ€§èƒ½å‰–æå®æˆ˜](12.2-æ€§èƒ½å‰–æå®æˆ˜.md) - æ€§èƒ½ä¼˜åŒ–
- [å®‰å…¨åŠ å›ºå®è·µ](12.4-å®‰å…¨åŠ å›ºå®è·µ.md) - å®‰å…¨æªæ–½
