# OPAï¼ˆOpen Policy Agentï¼‰å…¨é¢æŠ€æœ¯åˆ†æ - æ€»è§ˆä¸ç´¢å¼•

> **æ›´æ–°æ—¥æœŸ**: 2025å¹´10æœˆ21æ—¥  
> **ç‰ˆæœ¬**: v2.0  
> **çŠ¶æ€**: æ ¸å¿ƒæ¨¡å—å®Œæˆï¼Œå…±24ç¯‡æ–‡æ¡£

---

## ç›®å½•

- [OPAï¼ˆOpen Policy Agentï¼‰å…¨é¢æŠ€æœ¯åˆ†æ - æ€»è§ˆä¸ç´¢å¼•](#opaopen-policy-agentå…¨é¢æŠ€æœ¯åˆ†æ---æ€»è§ˆä¸ç´¢å¼•)
  - [ç›®å½•](#ç›®å½•)
  - [ğŸ“‹ æ–‡æ¡£å¯¼èˆª](#-æ–‡æ¡£å¯¼èˆª)
    - [æ–‡æ¡£ç»“æ„](#æ–‡æ¡£ç»“æ„)
  - [ğŸ¯ æ ¸å¿ƒæŠ€æœ¯ç»´åº¦](#-æ ¸å¿ƒæŠ€æœ¯ç»´åº¦)
    - [1. **æŠ€æœ¯è§„èŒƒå±‚**ï¼ˆTechnical Specificationsï¼‰](#1-æŠ€æœ¯è§„èŒƒå±‚technical-specifications)
    - [2. **è¯­è¨€æ¨¡å‹å±‚**ï¼ˆLanguage Semanticsï¼‰](#2-è¯­è¨€æ¨¡å‹å±‚language-semantics)
    - [3. **å®ç°æ¶æ„å±‚**ï¼ˆImplementation Architectureï¼‰](#3-å®ç°æ¶æ„å±‚implementation-architecture)
    - [4. **ç”Ÿæ€é›†æˆå±‚**ï¼ˆEcosystem Integrationï¼‰](#4-ç”Ÿæ€é›†æˆå±‚ecosystem-integration)
  - [ğŸ”¬ å½¢å¼åŒ–åˆ†ææ¡†æ¶](#-å½¢å¼åŒ–åˆ†ææ¡†æ¶)
    - [è¯­ä¹‰æ¨¡å‹ï¼ˆSemantic Modelï¼‰](#è¯­ä¹‰æ¨¡å‹semantic-model)
      - [1. è¯­æ³•åŸŸï¼ˆSyntactic Domainsï¼‰](#1-è¯­æ³•åŸŸsyntactic-domains)
      - [2. æ±‚å€¼å…³ç³»ï¼ˆEvaluation Relationï¼‰](#2-æ±‚å€¼å…³ç³»evaluation-relation)
      - [3. æ ¸å¿ƒæ¨ç†è§„åˆ™](#3-æ ¸å¿ƒæ¨ç†è§„åˆ™)
  - [ğŸ“Š æ¦‚å¿µå…³ç³»å›¾è°±](#-æ¦‚å¿µå…³ç³»å›¾è°±)
    - [æ ¸å¿ƒæ¦‚å¿µäº”å…ƒç»„](#æ ¸å¿ƒæ¦‚å¿µäº”å…ƒç»„)
      - [å®ä½“ï¼ˆEntitiesï¼‰](#å®ä½“entities)
      - [å…³ç³»çŸ©é˜µï¼ˆRelation Matrixï¼‰](#å…³ç³»çŸ©é˜µrelation-matrix)
  - [ğŸ—ï¸ æŠ€æœ¯æ ˆæ˜ å°„](#ï¸-æŠ€æœ¯æ ˆæ˜ å°„)
    - [è¯­è¨€å®ç°æ ˆ](#è¯­è¨€å®ç°æ ˆ)
    - [éƒ¨ç½²å½¢æ€çŸ©é˜µ](#éƒ¨ç½²å½¢æ€çŸ©é˜µ)
  - [ğŸ§¬ é€’å½’ä¸»é¢˜å±•å¼€](#-é€’å½’ä¸»é¢˜å±•å¼€)
    - [ä¸»é¢˜åˆ†è§£æ ‘ï¼ˆTopic Decomposition Treeï¼‰](#ä¸»é¢˜åˆ†è§£æ ‘topic-decomposition-tree)
    - [é€’å½’æ·±åº¦ç¤ºä¾‹ï¼šRBACä¸»é¢˜](#é€’å½’æ·±åº¦ç¤ºä¾‹rbacä¸»é¢˜)
  - [ğŸ“ˆ 2025å¹´æŠ€æœ¯è¶‹åŠ¿](#-2025å¹´æŠ€æœ¯è¶‹åŠ¿)
    - [è·¯çº¿å›¾å¯¹é½](#è·¯çº¿å›¾å¯¹é½)
    - [æ–°å…´åº”ç”¨é¢†åŸŸ](#æ–°å…´åº”ç”¨é¢†åŸŸ)
  - [ğŸ” å¦‚ä½•ä½¿ç”¨æœ¬æ–‡æ¡£](#-å¦‚ä½•ä½¿ç”¨æœ¬æ–‡æ¡£)
    - [å­¦ä¹ è·¯å¾„å»ºè®®](#å­¦ä¹ è·¯å¾„å»ºè®®)
      - [åˆå­¦è€…è·¯å¾„](#åˆå­¦è€…è·¯å¾„)
      - [å·¥ç¨‹å¸ˆè·¯å¾„](#å·¥ç¨‹å¸ˆè·¯å¾„)
      - [ç ”ç©¶è€…è·¯å¾„](#ç ”ç©¶è€…è·¯å¾„)
      - [æ¶æ„å¸ˆè·¯å¾„](#æ¶æ„å¸ˆè·¯å¾„)
  - [ğŸ“š å‚è€ƒæ–‡çŒ®ä¸èµ„æº](#-å‚è€ƒæ–‡çŒ®ä¸èµ„æº)
    - [å®˜æ–¹èµ„æº](#å®˜æ–¹èµ„æº)
    - [å­¦æœ¯è®ºæ–‡](#å­¦æœ¯è®ºæ–‡)
    - [è§„èŒƒæ–‡æ¡£](#è§„èŒƒæ–‡æ¡£)
    - [ç¤¾åŒºèµ„æº](#ç¤¾åŒºèµ„æº)
  - [ğŸ“ æ–‡æ¡£çº¦å®š](#-æ–‡æ¡£çº¦å®š)
    - [ç¬¦å·è¯´æ˜](#ç¬¦å·è¯´æ˜)
    - [ä»£ç ç¤ºä¾‹æ ¼å¼](#ä»£ç ç¤ºä¾‹æ ¼å¼)
    - [å½¢å¼åŒ–è¡¨ç¤º](#å½¢å¼åŒ–è¡¨ç¤º)
  - [ğŸ¤ è´¡çŒ®ä¸ç»´æŠ¤](#-è´¡çŒ®ä¸ç»´æŠ¤)
  - [ğŸ“Œ å¿«é€Ÿç´¢å¼•](#-å¿«é€Ÿç´¢å¼•)
    - [å…³é”®æ¦‚å¿µé€ŸæŸ¥](#å…³é”®æ¦‚å¿µé€ŸæŸ¥)
    - [APIé€ŸæŸ¥](#apié€ŸæŸ¥)

## ğŸ“‹ æ–‡æ¡£å¯¼èˆª

æœ¬æ–‡æ¡£ä½“ç³»å¯¹OPAè¿›è¡Œå…¨æ–¹ä½ã€é€’å½’å¼ã€å½¢å¼åŒ–çš„æŠ€æœ¯åˆ†æï¼Œæ¶µç›–ä»ç†è®ºåŸºç¡€åˆ°å·¥ç¨‹å®è·µçš„å®Œæ•´æŠ€æœ¯æ ˆã€‚

### âš¡ å¿«é€Ÿå…¥å£

**æ–°æ‰‹å¿…è¯»**ï¼š
- ğŸ“– [å¿«é€Ÿå‚è€ƒæŒ‡å—](./QUICK_REFERENCE.md) - ä¸€é¡µçº¸æŒæ¡æ ¸å¿ƒè¯­æ³•
- â“ [å¸¸è§é—®é¢˜è§£ç­”](./FAQ.md) - 22ä¸ªé«˜é¢‘é—®é¢˜å¿«é€Ÿè§£ç­”

### æ–‡æ¡£ç»“æ„

```text
OPA æŠ€æœ¯åˆ†æä½“ç³»
â”œâ”€â”€ 00-æ€»è§ˆä¸ç´¢å¼•.md                    [æœ¬æ–‡æ¡£]
â”œâ”€â”€ QUICK_REFERENCE.md                 â­ å¿«é€Ÿå‚è€ƒ
â”œâ”€â”€ FAQ.md                            â­ å¸¸è§é—®é¢˜
â”œâ”€â”€ 01-æŠ€æœ¯è§„èŒƒ/                       æ ¸å¿ƒæŠ€æœ¯è§„èŒƒè¯¦è§£
â”‚   â”œâ”€â”€ 01.1-APIè§„èŒƒ.md
â”‚   â”œâ”€â”€ 01.2-Bundleæ ¼å¼è§„èŒƒ.md
â”‚   â”œâ”€â”€ 01.3-WASMç¼–è¯‘è§„èŒƒ.md
â”‚   â”œâ”€â”€ 01.4-æ€§èƒ½åŸºå‡†ä¸åº¦é‡.md
â”‚   â””â”€â”€ 01.5-å®‰å…¨åˆè§„æ ‡å‡†.md
â”œâ”€â”€ 02-è¯­è¨€æ¨¡å‹/                       Regoè¯­è¨€æ·±åº¦å‰–æ
â”‚   â”œâ”€â”€ 02.1-Regoè¯­æ³•è§„èŒƒ.md
â”‚   â”œâ”€â”€ 02.2-ç±»å‹ç³»ç»Ÿ.md
â”‚   â”œâ”€â”€ 02.3-å†…ç½®å‡½æ•°åº“.md
â”‚   â””â”€â”€ 02.4-æ±‚å€¼æ¨¡å‹.md
â”œâ”€â”€ 03-å®ç°æ¶æ„/                       å†…éƒ¨å®ç°æœºåˆ¶
â”‚   â”œâ”€â”€ 03.1-è¯æ³•åˆ†æä¸è¯­æ³•è§£æ.md
â”‚   â”œâ”€â”€ 03.2-ASTä¸IR.md
â”‚   â”œâ”€â”€ 03.3-ç¼–è¯‘å™¨è®¾è®¡.md
â”‚   â”œâ”€â”€ 03.4-Top-Downæ±‚å€¼å™¨.md
â”‚   â”œâ”€â”€ 03.5-ç´¢å¼•ä¸ä¼˜åŒ–.md
â”‚   â””â”€â”€ 03.6-éƒ¨åˆ†æ±‚å€¼æŠ€æœ¯.md
â”œâ”€â”€ 04-ç”Ÿæ€ç³»ç»Ÿ/                       äº‘åŸç”Ÿé›†æˆ
â”‚   â”œâ”€â”€ 04.1-Kubernetesé›†æˆ.md
â”‚   â””â”€â”€ 04.2-Gatekeeperè¯¦è§£.md
â”œâ”€â”€ 05-åº”ç”¨åœºæ™¯/                       å®æˆ˜åº”ç”¨æ¡ˆä¾‹
â”‚   â”œâ”€â”€ 05.1-è®¿é—®æ§åˆ¶(RBAC).md
â”‚   â””â”€â”€ 05.2-APIç½‘å…³æˆæƒ.md
â”œâ”€â”€ 06-å½¢å¼åŒ–è¯æ˜/                     ç†è®ºåŸºç¡€ä¸è¯æ˜
â”‚   â”œâ”€â”€ 06.1-Datalogç†è®ºåŸºç¡€.md
â”‚   â””â”€â”€ 06.2-Regoå½¢å¼åŒ–è¯­ä¹‰.md
â”œâ”€â”€ 07-æ¦‚å¿µå›¾è°±/                       æ¦‚å¿µå…³ç³»ç½‘ç»œ
â”‚   â””â”€â”€ 07.1-æ ¸å¿ƒæ¦‚å¿µå®šä¹‰.md
â””â”€â”€ 08-æœ€ä½³å®è·µ/                       å·¥ç¨‹å®è·µæŒ‡å—
    â”œâ”€â”€ 08.1-ç­–ç•¥è®¾è®¡æ¨¡å¼.md
    â””â”€â”€ 08.2-æ€§èƒ½ä¼˜åŒ–æŒ‡å—.md
```

---

## ğŸ¯ æ ¸å¿ƒæŠ€æœ¯ç»´åº¦

### 1. **æŠ€æœ¯è§„èŒƒå±‚**ï¼ˆTechnical Specificationsï¼‰

| è§„èŒƒé¢†åŸŸ | æ ¸å¿ƒæ ‡å‡† | å½“å‰ç‰ˆæœ¬ | ç¨³å®šæ€§ |
|---------|---------|---------|--------|
| Regoè¯­è¨€è§„èŒƒ | v1.0ï¼ˆè¯­æ³•å†»ç»“ï¼‰ | 2025 Q4 | ğŸŸ¢ ç¨³å®š |
| REST API | OpenAPI 3.0 | v1/v2 åŒç‰ˆæœ¬ | ğŸŸ¢ ç¨³å®š |
| gRPCåè®® | Protocol Buffers 3 | v1 | ğŸŸ¢ ç¨³å®š |
| Bundleæ ¼å¼ | tar.gz + manifest | v1 Schema | ğŸŸ¢ ç¨³å®š |
| WASMç›®æ ‡ | WASI snapshot1/2 | æŒç»­æ¼”è¿› | ğŸŸ¡ æ´»è·ƒ |
| æ€§èƒ½åŸºå‡† | CNCFæ ‡å‡† | 100ä¸‡+å†³ç­–/ç§’ | ğŸŸ¢ ç¨³å®š |

### 2. **è¯­è¨€æ¨¡å‹å±‚**ï¼ˆLanguage Semanticsï¼‰

```text
Rego è¯­è¨€ç‰¹å¾
â”œâ”€â”€ å£°æ˜å¼èŒƒå¼ï¼ˆDeclarativeï¼‰
â”œâ”€â”€ Datalogå˜ä½“ï¼ˆDatalog-inspiredï¼‰
â”œâ”€â”€ æ— å‰¯ä½œç”¨ï¼ˆSide-effect freeï¼‰
â”œâ”€â”€ åŠ¨æ€å¼ºç±»å‹ï¼ˆDynamically typedï¼‰
â”œâ”€â”€ é€»è¾‘æ¨ç†ï¼ˆLogical inferenceï¼‰
â””â”€â”€ é›†åˆæ¨å¯¼ï¼ˆComprehensionsï¼‰
```

**å½¢å¼åŒ–å®šä¹‰**:

- **è¯­æ³•**: ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼ˆCFGï¼‰
- **è¯­ä¹‰**: æ“ä½œè¯­ä¹‰ï¼ˆOperational Semanticsï¼‰
- **ç±»å‹ç³»ç»Ÿ**: ç»“æ„åŒ–ç±»å‹ï¼ˆStructural Typingï¼‰
- **æ±‚å€¼ç­–ç•¥**: è‡ªé¡¶å‘ä¸‹ï¼ˆTop-Downï¼‰
- **ç»ˆæ­¢æ€§**: å¾ªç¯æ£€æµ‹ï¼ˆCycle Detectionï¼‰

### 3. **å®ç°æ¶æ„å±‚**ï¼ˆImplementation Architectureï¼‰

```text
æ‰§è¡Œæµæ°´çº¿
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rego Source â”‚â†’  â”‚   Parser    â”‚â†’  â”‚   Compiler  â”‚â†’  â”‚  Evaluator  â”‚
â”‚   (.rego)   â”‚   â”‚  (ASTç”Ÿæˆ)  â”‚   â”‚  (IRè½¬æ¢)   â”‚   â”‚  (æ±‚å€¼å¼•æ“)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â†“
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  Optimizations  â”‚
                                  â”‚  â€¢ Indexing     â”‚
                                  â”‚  â€¢ Partial Eval â”‚
                                  â”‚  â€¢ Caching      â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç»„ä»¶**:

- **Lexer**: åŸºäºGoçš„scanneråŒ…
- **Parser**: é€’å½’ä¸‹é™è§£æå™¨
- **Compiler**: å¤šé˜¶æ®µç¼–è¯‘ï¼ˆ3-passï¼‰
- **Evaluator**: ç»Ÿä¸€æ±‚å€¼ç®—æ³•
- **Storage**: å†…å­˜æ•°æ®åº“ï¼ˆTrieç»“æ„ï¼‰

### 4. **ç”Ÿæ€é›†æˆå±‚**ï¼ˆEcosystem Integrationï¼‰

| é›†æˆç‚¹ | æŠ€æœ¯æ ˆ | é›†æˆæ¨¡å¼ | æˆç†Ÿåº¦ |
|-------|-------|---------|--------|
| **Kubernetes** | Admission Webhook | Gatekeeper | CNCFæ¯•ä¸š |
| **Envoy/Istio** | ext_authz gRPC | Sidecar | ç”Ÿäº§çº§ |
| **CI/CD** | Conftest | CLIå·¥å…· | å¹¿æ³›é‡‡ç”¨ |
| **Terraform** | OPA Plugin | ç­–ç•¥å³ä»£ç  | ç”Ÿäº§çº§ |
| **Docker** | OCI Hooks | ImageéªŒè¯ | æ´»è·ƒ |
| **äº‘å¹³å°** | AWS/GCP/Azure | æ‰˜ç®¡æœåŠ¡ | å•†ä¸šæ”¯æŒ |

---

## ğŸ”¬ å½¢å¼åŒ–åˆ†ææ¡†æ¶

### è¯­ä¹‰æ¨¡å‹ï¼ˆSemantic Modelï¼‰

OPA/Regoçš„å½¢å¼åŒ–è¯­ä¹‰å¯ç”¨**æ“ä½œè¯­ä¹‰**ï¼ˆOperational Semanticsï¼‰è¡¨ç¤ºï¼š

#### 1. è¯­æ³•åŸŸï¼ˆSyntactic Domainsï¼‰

```text
æœ¯è¯­ t ::= v                    (å˜é‡)
        | c                    (å¸¸é‡)
        | [tâ‚, tâ‚‚, ..., tâ‚™]   (æ•°ç»„)
        | {kâ‚: vâ‚, ..., kâ‚™: vâ‚™} (å¯¹è±¡)
        | {tâ‚, tâ‚‚, ..., tâ‚™}   (é›†åˆ)

æŸ¥è¯¢ q ::= tâ‚ = tâ‚‚              (ç»Ÿä¸€)
         | tâ‚ := tâ‚‚             (èµ‹å€¼)
         | tâ‚ == tâ‚‚             (æ¯”è¾ƒ)
         | f(tâ‚, ..., tâ‚™)       (å‡½æ•°è°ƒç”¨)
         | qâ‚; qâ‚‚               (è¿æ¥)
         | qâ‚ | qâ‚‚              (é€‰æ‹©)

è§„åˆ™ r ::= head :- body         (è•´æ¶µå¼)
```

#### 2. æ±‚å€¼å…³ç³»ï¼ˆEvaluation Relationï¼‰

```text
Î“ âŠ¢ q â‡“ Î¸
```

- `Î“`: ç¯å¢ƒï¼ˆå˜é‡ç»‘å®šï¼‰
- `q`: æŸ¥è¯¢
- `Î¸`: ç»“æœç»‘å®šé›†åˆ

#### 3. æ ¸å¿ƒæ¨ç†è§„åˆ™

**ç»Ÿä¸€è§„åˆ™**:

```text
Î“ âŠ¢ tâ‚ â‡“ vâ‚    Î“ âŠ¢ tâ‚‚ â‡“ vâ‚‚    unify(vâ‚, vâ‚‚) = Î¸
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            Î“ âŠ¢ tâ‚ = tâ‚‚ â‡“ Î¸
```

**è§„åˆ™è°ƒç”¨**:

```text
Î“ âŠ¢ body â‡“ Î¸â‚    Î¸â‚(head) = result
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Î“ âŠ¢ rule â‡“ {result}
```

**è¯¦è§**: `06-å½¢å¼åŒ–è¯æ˜/06.2-Regoå½¢å¼åŒ–è¯­ä¹‰.md`

---

## ğŸ“Š æ¦‚å¿µå…³ç³»å›¾è°±

### æ ¸å¿ƒæ¦‚å¿µäº”å…ƒç»„

```text
C = (Entity, Attribute, Relation, Constraint, Operation)
```

#### å®ä½“ï¼ˆEntitiesï¼‰

```mermaid
graph TD
    A[Policy] -->|contains| B[Rule]
    B -->|has| C[Head]
    B -->|has| D[Body]
    D -->|composed of| E[Query]
    E -->|operates on| F[Term]
    G[Data] -->|provides| F
    H[Input] -->|provides| F
```

#### å…³ç³»çŸ©é˜µï¼ˆRelation Matrixï¼‰

|     | Policy | Rule | Data | Input | Query | Decision |
|-----|--------|------|------|-------|-------|----------|
| **Policy** | âŠ‡ | â† | â†’ | â† | âŠ‡ | â†’ |
| **Rule** | â†’ | â‡” | â† | â† | âŠ‡ | â†’ |
| **Data** | â† | â†’ | - | âŠ¥ | â†’ | â†’ |
| **Input** | â†’ | â†’ | âŠ¥ | - | â†’ | â†’ |
| **Query** | â† | â† | â† | â† | â‡” | â†’ |
| **Decision** | â† | â† | â† | â† | â† | - |

**ç¬¦å·è¯´æ˜**:

- `â†’`: ä¾èµ–å…³ç³»
- `âŠ‡`: åŒ…å«å…³ç³»
- `â‡”`: åŒå‘ä¾èµ–
- `âŠ¥`: äº’æ–¥å…³ç³»
- `-`: è‡ªåå…³ç³»

**è¯¦è§**: `07-æ¦‚å¿µå›¾è°±/07.2-å…³ç³»çŸ©é˜µ.md`

---

## ğŸ—ï¸ æŠ€æœ¯æ ˆæ˜ å°„

### è¯­è¨€å®ç°æ ˆ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application Layer                  â”‚
â”‚  â€¢ REST API (HTTP/1.1, HTTP/2)              â”‚
â”‚  â€¢ gRPC (Protocol Buffers)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Runtime Layer                      â”‚
â”‚  â€¢ Rego Evaluator (Go)                      â”‚
â”‚  â€¢ WASM Runtime (Wasm3/WAMR)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Storage Layer                      â”‚
â”‚  â€¢ In-Memory (Trie)                         â”‚
â”‚  â€¢ Bundle (tar.gz)                          â”‚
â”‚  â€¢ Remote (OCI/Git/HTTP)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Infrastructure Layer               â”‚
â”‚  â€¢ Go 1.22+ (stdlib)                        â”‚
â”‚  â€¢ Zero CGO Dependencies                    â”‚
â”‚  â€¢ Cross-Platform (GOOS/GOARCH)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éƒ¨ç½²å½¢æ€çŸ©é˜µ

| å½¢æ€ | å»¶è¿Ÿ | ååé‡ | éš”ç¦»æ€§ | é€‚ç”¨åœºæ™¯ |
|------|------|--------|--------|----------|
| **Sidecar** | < 1ms | é«˜ | è¿›ç¨‹çº§ | K8så¾®æœåŠ¡ |
| **Library** | < 0.1ms | æé«˜ | æ—  | è¿›ç¨‹å†…åµŒå…¥ |
| **Server** | 1-5ms | ä¸­ | ç½‘ç»œçº§ | å…±äº«ç­–ç•¥æœåŠ¡ |
| **WASM** | < 0.5ms | é«˜ | æ²™ç®± | è¾¹ç¼˜/æµè§ˆå™¨ |
| **DaemonSet** | 1-10ms | ä¸­ | èŠ‚ç‚¹çº§ | ä¸»æœºå®¡è®¡ |

---

## ğŸ§¬ é€’å½’ä¸»é¢˜å±•å¼€

### ä¸»é¢˜åˆ†è§£æ ‘ï¼ˆTopic Decomposition Treeï¼‰

```text
OPA
â”œâ”€â”€ 1. ç­–ç•¥å³ä»£ç ï¼ˆPolicy as Codeï¼‰
â”‚   â”œâ”€â”€ 1.1 å£°æ˜å¼å®šä¹‰
â”‚   â”œâ”€â”€ 1.2 ç‰ˆæœ¬æ§åˆ¶
â”‚   â”œâ”€â”€ 1.3 æµ‹è¯•é©±åŠ¨
â”‚   â””â”€â”€ 1.4 CI/CDé›†æˆ
â”‚
â”œâ”€â”€ 2. è§£è€¦å†³ç­–é€»è¾‘ï¼ˆDecision Decouplingï¼‰
â”‚   â”œâ”€â”€ 2.1 é€»è¾‘ä¸åº”ç”¨åˆ†ç¦»
â”‚   â”œâ”€â”€ 2.2 ç»Ÿä¸€ç­–ç•¥è¯­è¨€
â”‚   â”œâ”€â”€ 2.3 é›†ä¸­ç®¡ç†
â”‚   â””â”€â”€ 2.4 åŠ¨æ€æ›´æ–°
â”‚
â”œâ”€â”€ 3. é€šç”¨ç­–ç•¥å¼•æ“ï¼ˆGeneral Purposeï¼‰
â”‚   â”œâ”€â”€ 3.1 é¢†åŸŸæ— å…³
â”‚   â”œâ”€â”€ 3.2 æ•°æ®ç»“æ„çµæ´»
â”‚   â”œâ”€â”€ 3.3 æŸ¥è¯¢èƒ½åŠ›å¼ºå¤§
â”‚   â””â”€â”€ 3.4 æ‰©å±•æ€§å¼º
â”‚
â”œâ”€â”€ 4. äº‘åŸç”Ÿé›†æˆï¼ˆCloud Nativeï¼‰
â”‚   â”œâ”€â”€ 4.1 å®¹å™¨å‹å¥½
â”‚   â”œâ”€â”€ 4.2 K8såŸç”Ÿ
â”‚   â”œâ”€â”€ 4.3 æœåŠ¡ç½‘æ ¼é›†æˆ
â”‚   â””â”€â”€ 4.4 å¯è§‚æµ‹æ€§
â”‚
â””â”€â”€ 5. é«˜æ€§èƒ½å†³ç­–ï¼ˆHigh Performanceï¼‰
    â”œâ”€â”€ 5.1 ç¼–è¯‘ä¼˜åŒ–
    â”œâ”€â”€ 5.2 ç´¢å¼•åŠ é€Ÿ
    â”œâ”€â”€ 5.3 éƒ¨åˆ†æ±‚å€¼
    â””â”€â”€ 5.4 ç¼“å­˜ç­–ç•¥
```

### é€’å½’æ·±åº¦ç¤ºä¾‹ï¼šRBACä¸»é¢˜

```text
RBAC (Role-Based Access Control)
â”œâ”€â”€ L1: åŸºæœ¬æ¦‚å¿µ
â”‚   â”œâ”€â”€ Userï¼ˆç”¨æˆ·ï¼‰
â”‚   â”œâ”€â”€ Roleï¼ˆè§’è‰²ï¼‰
â”‚   â”œâ”€â”€ Permissionï¼ˆæƒé™ï¼‰
â”‚   â””â”€â”€ Resourceï¼ˆèµ„æºï¼‰
â”‚
â”œâ”€â”€ L2: å…³ç³»å®šä¹‰
â”‚   â”œâ”€â”€ User âŠ† Role (ç”¨æˆ·-è§’è‰²åˆ†é…)
â”‚   â”œâ”€â”€ Role âŠ† Permission (è§’è‰²-æƒé™ç»‘å®š)
â”‚   â””â”€â”€ Permission â†’ Resource (æƒé™-èµ„æºæ˜ å°„)
â”‚
â”œâ”€â”€ L3: Regoå®ç°
â”‚   â”œâ”€â”€ æ•°æ®æ¨¡å‹è®¾è®¡
â”‚   â”œâ”€â”€ è§„åˆ™å®šä¹‰
â”‚   â”œâ”€â”€ æŸ¥è¯¢æ¥å£
â”‚   â””â”€â”€ æµ‹è¯•ç”¨ä¾‹
â”‚
â”œâ”€â”€ L4: é«˜çº§ç‰¹æ€§
â”‚   â”œâ”€â”€ å±‚çº§è§’è‰²ï¼ˆRole Hierarchyï¼‰
â”‚   â”œâ”€â”€ åŠ¨æ€æƒé™ï¼ˆDynamic Permissionsï¼‰
â”‚   â”œâ”€â”€ ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼ˆContext-Awareï¼‰
â”‚   â””â”€â”€ æ—¶é—´çº¦æŸï¼ˆTemporal Constraintsï¼‰
â”‚
â””â”€â”€ L5: å·¥ç¨‹å®è·µ
    â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–ï¼ˆç´¢å¼•ç­–ç•¥ï¼‰
    â”œâ”€â”€ è§„æ¨¡åŒ–ç®¡ç†ï¼ˆæ•°åƒè§’è‰²ï¼‰
    â”œâ”€â”€ å®¡è®¡æ—¥å¿—ï¼ˆDecision Logsï¼‰
    â””â”€â”€ é›†æˆæ¨¡å¼ï¼ˆAPI Gatewayï¼‰
```

**è¯¦è§**: `05-åº”ç”¨åœºæ™¯/05.1-è®¿é—®æ§åˆ¶(RBAC).md`

---

## ğŸ“ˆ 2025å¹´æŠ€æœ¯è¶‹åŠ¿

### è·¯çº¿å›¾å¯¹é½

| æ–¹å‘ | æ—¶é—´çº¿ | æŠ€æœ¯ç»†èŠ‚ | å½±å“ |
|------|--------|----------|------|
| **Rego v1.0å†»ç»“** | 2025 Q4 | è¯­æ³•è§„èŒƒå›ºåŒ–ï¼Œ5å¹´å‘åå…¼å®¹ | ğŸ”´ å…³é”® |
| **ç±»å‹æ£€æŸ¥å™¨GA** | 2025 Q4 | é™æ€ç±»å‹æ¨å¯¼ï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹ | ğŸŸ¡ é‡è¦ |
| **AI Policy Gen** | 2025 Q1-Q3 | GPTé©±åŠ¨çš„Regoç”Ÿæˆ+æµ‹è¯• | ğŸŸ¢ æ¢ç´¢ |
| **WASI 2.0æ”¯æŒ** | 2025-2026 | WASMç»„ä»¶æ¨¡å‹ï¼ŒI/Oèƒ½åŠ› | ğŸŸ¡ é‡è¦ |
| **åˆ†å¸ƒå¼è¿½è¸ª** | 2025 Q2 | OpenTelemetryåŸç”Ÿé›†æˆ | ğŸŸ¢ è¡¥å…… |

### æ–°å…´åº”ç”¨é¢†åŸŸ

1. **ä¾›åº”é“¾å®‰å…¨**ï¼ˆSLSAé›†æˆï¼‰
2. **eBPFç­–ç•¥**ï¼ˆå†…æ ¸çº§å†³ç­–ï¼‰
3. **è¾¹ç¼˜è®¡ç®—**ï¼ˆCDNèŠ‚ç‚¹ç­–ç•¥ï¼‰
4. **è”é‚¦å­¦ä¹ **ï¼ˆéšç§è®¡ç®—ç­–ç•¥ï¼‰
5. **é‡å­ååŠ å¯†**ï¼ˆå¯†ç ç­–ç•¥ç®¡ç†ï¼‰

---

## ğŸ” å¦‚ä½•ä½¿ç”¨æœ¬æ–‡æ¡£

### å­¦ä¹ è·¯å¾„å»ºè®®

#### åˆå­¦è€…è·¯å¾„

```text
START â†’ 07.1-æ ¸å¿ƒæ¦‚å¿µå®šä¹‰ 
      â†’ 02.1-Regoè¯­æ³•è§„èŒƒ 
      â†’ 05.1-è®¿é—®æ§åˆ¶(RBAC)
      â†’ 08.3-æµ‹è¯•ç­–ç•¥
      â†’ END
```

#### å·¥ç¨‹å¸ˆè·¯å¾„

```text
START â†’ 01-æŠ€æœ¯è§„èŒƒï¼ˆå…¨è¯»ï¼‰
      â†’ 03-å®ç°æ¶æ„ï¼ˆé‡ç‚¹03.4-03.6ï¼‰
      â†’ 04-ç”Ÿæ€ç³»ç»Ÿï¼ˆæŒ‰éœ€ï¼‰
      â†’ 08-æœ€ä½³å®è·µï¼ˆå…¨è¯»ï¼‰
      â†’ END
```

#### ç ”ç©¶è€…è·¯å¾„

```text
START â†’ 06-å½¢å¼åŒ–è¯æ˜ï¼ˆå…¨è¯»ï¼‰
      â†’ 02.2-è¯­ä¹‰æ¨¡å‹
      â†’ 03.2-ASTä¸IR
      â†’ 06.3-æ±‚å€¼æ­£ç¡®æ€§è¯æ˜
      â†’ END
```

#### æ¶æ„å¸ˆè·¯å¾„

```text
START â†’ 00-æ€»è§ˆä¸ç´¢å¼•ï¼ˆæœ¬æ–‡ï¼‰
      â†’ 04-ç”Ÿæ€ç³»ç»Ÿï¼ˆå…¨è¯»ï¼‰
      â†’ 05-åº”ç”¨åœºæ™¯ï¼ˆå…¨è¯»ï¼‰
      â†’ 08.4-éƒ¨ç½²æ¶æ„
      â†’ 01.4-æ€§èƒ½åŸºå‡†ä¸åº¦é‡
      â†’ END
```

---

## ğŸ“š å‚è€ƒæ–‡çŒ®ä¸èµ„æº

### å®˜æ–¹èµ„æº

- **å®˜æ–¹æ–‡æ¡£**: <https://www.openpolicyagent.org/docs/>
- **GitHubä»“åº“**: <https://github.com/open-policy-agent/opa>
- **Rego Playground**: <https://play.openpolicyagent.org/>
- **CNCFé¡¹ç›®é¡µ**: <https://www.cncf.io/projects/open-policy-agent-opa/>

### å­¦æœ¯è®ºæ–‡

1. **"Policy-Based Decoupled Decision Making"** (NSDI 2020)
2. **"Rego: A Query Language for Policy"** (Technical Report)
3. **"Formal Verification of Cloud Policies"** (SOSP 2021)

### è§„èŒƒæ–‡æ¡£

- **OpenAPI Spec**: `/v1/data` API
- **Bundle Specification**: v1 Schema
- **WASI Specification**: snapshot1/2

### ç¤¾åŒºèµ„æº

- **OPA Slack**: `#opa` on CNCF Slack
- **Monthly Community Meetings**: ç¬¬ä¸€ä¸ªå‘¨å››
- **StackOverflow**: `[open-policy-agent]` tag

---

## ğŸ“ æ–‡æ¡£çº¦å®š

### ç¬¦å·è¯´æ˜

- `âœ…`: å®˜æ–¹ç»´æŠ¤/CNCFæ¯•ä¸š
- `ğŸŸ¢`: ç¨³å®š/æ¨è
- `ğŸŸ¡`: æ´»è·ƒå¼€å‘/Beta
- `ğŸ”´`: å®éªŒæ€§/ä¸æ¨è
- `âš ï¸`: å·²åºŸå¼ƒ/è¿ç§»ä¸­

### ä»£ç ç¤ºä¾‹æ ¼å¼

```rego
# ç­–ç•¥è§„åˆ™ç¤ºä¾‹
package example

import future.keywords.if
import future.keywords.in

# å…è®¸ç®¡ç†å‘˜è®¿é—®
allow if {
    input.user.role == "admin"
}
```

### å½¢å¼åŒ–è¡¨ç¤º

- **å¸Œè…Šå­—æ¯**: å…ƒå˜é‡ï¼ˆå¦‚ `Î“`, `Î¸`, `Ïƒ`ï¼‰
- **æ•°å­¦ç¬¦å·**: é›†åˆè®ºï¼ˆ`âˆˆ`, `âŠ†`, `âˆª`, `âˆ©`ï¼‰
- **é€»è¾‘ç¬¦å·**: é€»è¾‘æ¨ç†ï¼ˆ`âŠ¢`, `â‡“`, `â†’`, `âˆ§`, `âˆ¨`ï¼‰

---

## ğŸ¤ è´¡çŒ®ä¸ç»´æŠ¤

æœ¬æ–‡æ¡£ä½“ç³»æŒç»­æ›´æ–°ï¼Œä¸OPAå®˜æ–¹ç‰ˆæœ¬ä¿æŒåŒæ­¥ã€‚

**æ›´æ–°å‘¨æœŸ**:

- **ä¸»ç‰ˆæœ¬å‘å¸ƒ**: å…¨é¢å®¡æŸ¥
- **æœˆåº¦æ›´æ–°**: è¡¥å……æœ€æ–°ç‰¹æ€§
- **æ¯å‘¨**: å‹˜è¯¯ä¸ä¼˜åŒ–

**è”ç³»æ–¹å¼**: è¯¦è§é¡¹ç›®README

---

## ğŸ“Œ å¿«é€Ÿç´¢å¼•

### å…³é”®æ¦‚å¿µé€ŸæŸ¥

| æ¦‚å¿µ | å®šä¹‰ä½ç½® | è¯¦ç»†æ–‡æ¡£ |
|------|---------|----------|
| **Rego** | 02.1 | 02-è¯­è¨€æ¨¡å‹/ |
| **Rule** | 07.1 | 02.1, 06.2 |
| **Policy** | 07.1 | 01-æŠ€æœ¯è§„èŒƒ/ |
| **Bundle** | 01.2 | 01.2-Bundleæ ¼å¼è§„èŒƒ.md |
| **WASM** | 01.3 | 01.3-WASMç¼–è¯‘è§„èŒƒ.md |
| **Gatekeeper** | 04.2 | 04.2-Gatekeeperè¯¦è§£.md |
| **Partial Evaluation** | 03.6 | 03.6-éƒ¨åˆ†æ±‚å€¼æŠ€æœ¯.md |
| **Datalog** | 06.1 | 06.1-Datalogç†è®ºåŸºç¡€.md |

### APIé€ŸæŸ¥

| ç«¯ç‚¹ | æ–¹æ³• | ç”¨é€” |
|------|------|------|
| `/v1/data/{path}` | POST | ç­–ç•¥æŸ¥è¯¢ |
| `/v1/policies/{id}` | PUT | ä¸Šä¼ ç­–ç•¥ |
| `/v1/compile` | POST | éƒ¨åˆ†æ±‚å€¼ |
| `/health` | GET | å¥åº·æ£€æŸ¥ |
| `/metrics` | GET | PrometheusæŒ‡æ ‡ |

---

**ä¸‹ä¸€æ­¥**: æ ¹æ®æ‚¨çš„è§’è‰²é€‰æ‹©å¯¹åº”çš„å­¦ä¹ è·¯å¾„ï¼Œå¼€å§‹æ·±å…¥æ¢ç´¢OPAæŠ€æœ¯æ ˆï¼

**æ¨èèµ·ç‚¹**: `07-æ¦‚å¿µå›¾è°±/07.1-æ ¸å¿ƒæ¦‚å¿µå®šä¹‰.md`
