# OPA/Rego ç‰ˆæœ¬å…¼å®¹æ€§è¯´æ˜

> **æœ€åæ›´æ–°**: 2025-10-25  
> **æ–‡æ¡£ç‰ˆæœ¬**: v1.1  
> **éªŒè¯å‘¨æœŸ**: æ¯æœˆæ£€æŸ¥å¹¶æ›´æ–°

---

## ğŸ“‹ å¿«é€Ÿå‚è€ƒ

| æœ¬é¡¹ç›®æ–‡æ¡£é€‚ç”¨ç‰ˆæœ¬ | OPAç‰ˆæœ¬ | Regoè¯­è¨€ç‰ˆæœ¬ | æµ‹è¯•çŠ¶æ€ |
|-------------------|---------|-------------|---------|
| **å½“å‰æ¨è** | **v0.68+** | **v1.0** | âœ… å·²éªŒè¯ |
| æœ€ä½è¦æ±‚ | v0.55+ | v1.0 | âœ… å…¼å®¹ |
| æµ‹è¯•è¦†ç›– | v0.55 - v0.68 | v1.0 | âœ… å…¨é¢ |

---

## ğŸ¯ æ ¸å¿ƒç‰ˆæœ¬ä¿¡æ¯

### OPAç‰ˆæœ¬

**æœ€æ–°ç¨³å®šç‰ˆ**: v0.68.0 (2024-10)  
**æœ€ä½æ”¯æŒç‰ˆ**: v0.55.0 (2023-08)  
**Rego v1å†»ç»“**: v0.42.0 (2022-06) å¼•å…¥Rego v1

### Regoè¯­è¨€ç‰ˆæœ¬

**å½“å‰ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… è¯­æ³•å·²å†»ç»“ï¼ˆè‡ª2022å¹´6æœˆï¼‰  
**è¯­æ³•**: ä½¿ç”¨ `import rego.v1` å¯ç”¨

---

## ğŸ“Š åŠŸèƒ½å…¼å®¹æ€§çŸ©é˜µ

### æ ¸å¿ƒè¯­è¨€ç‰¹æ€§

| ç‰¹æ€§ | æœ€ä½OPAç‰ˆæœ¬ | Regoç‰ˆæœ¬ | æœ¬æ–‡æ¡£ä½¿ç”¨ | è¯´æ˜ |
|------|------------|---------|-----------|------|
| åŸºç¡€è¯­æ³• | v0.1+ | - | âœ… | package, import, rules |
| `if` å…³é”®å­— | v0.42+ | v1.0 | âœ… | æ›¿ä»£ `:-` |
| `contains` å…³é”®å­— | v0.42+ | v1.0 | âœ… | é›†åˆè§„åˆ™ |
| `in` å…³é”®å­— | v0.42+ | v1.0 | âœ… | æˆå‘˜æµ‹è¯• |
| `every` å…³é”®å­— | v0.42+ | v1.0 | âœ… | å…¨ç§°é‡è¯ |
| `import rego.v1` | v0.42+ | v1.0 | âœ… | å¯ç”¨v1è¯­æ³• |

### ç¼–è¯‘å’Œéƒ¨ç½²

| ç‰¹æ€§ | æœ€ä½OPAç‰ˆæœ¬ | æµ‹è¯•çŠ¶æ€ | æœ¬æ–‡æ¡£è¦†ç›– |
|------|------------|---------|-----------|
| WASMç¼–è¯‘ | v0.20+ | âœ… | [01.3-WASMç¼–è¯‘è§„èŒƒ](docs/01-æŠ€æœ¯è§„èŒƒ/01.3-WASMç¼–è¯‘è§„èŒƒ.md) |
| Bundleæ‰“åŒ… | v0.10+ | âœ… | [01.2-Bundleæ ¼å¼è§„èŒƒ](docs/01-æŠ€æœ¯è§„èŒƒ/01.2-Bundleæ ¼å¼è§„èŒƒ.md) |
| éƒ¨åˆ†æ±‚å€¼ | v0.20+ | âœ… | [03.6-éƒ¨åˆ†æ±‚å€¼æŠ€æœ¯](docs/03-å®ç°æ¶æ„/03.6-éƒ¨åˆ†æ±‚å€¼æŠ€æœ¯.md) |
| IRä¼˜åŒ– | v0.50+ | âœ… | [03.3-ç¼–è¯‘å™¨è®¾è®¡](docs/03-å®ç°æ¶æ„/03.3-ç¼–è¯‘å™¨è®¾è®¡.md) |

### å†…ç½®å‡½æ•°

| å‡½æ•°ç±»åˆ« | æœ€ä½OPAç‰ˆæœ¬ | å‡½æ•°æ•°é‡ | æ–‡æ¡£é“¾æ¥ |
|---------|------------|---------|---------|
| å­—ç¬¦ä¸²æ“ä½œ | v0.1+ | 20+ | [02.3-å†…ç½®å‡½æ•°åº“](docs/02-è¯­è¨€æ¨¡å‹/02.3-å†…ç½®å‡½æ•°åº“.md#å­—ç¬¦ä¸²å‡½æ•°) |
| æ•°ç»„æ“ä½œ | v0.1+ | 15+ | [02.3-å†…ç½®å‡½æ•°åº“](docs/02-è¯­è¨€æ¨¡å‹/02.3-å†…ç½®å‡½æ•°åº“.md#æ•°ç»„å‡½æ•°) |
| å¯¹è±¡æ“ä½œ | v0.1+ | 10+ | [02.3-å†…ç½®å‡½æ•°åº“](docs/02-è¯­è¨€æ¨¡å‹/02.3-å†…ç½®å‡½æ•°åº“.md#å¯¹è±¡å‡½æ•°) |
| é›†åˆæ“ä½œ | v0.1+ | 10+ | [02.3-å†…ç½®å‡½æ•°åº“](docs/02-è¯­è¨€æ¨¡å‹/02.3-å†…ç½®å‡½æ•°åº“.md#é›†åˆå‡½æ•°) |
| JWT | v0.10+ | 5+ | [02.3-å†…ç½®å‡½æ•°åº“](docs/02-è¯­è¨€æ¨¡å‹/02.3-å†…ç½®å‡½æ•°åº“.md#jwtå‡½æ•°) |
| åŠ å¯† | v0.20+ | 8+ | [02.3-å†…ç½®å‡½æ•°åº“](docs/02-è¯­è¨€æ¨¡å‹/02.3-å†…ç½®å‡½æ•°åº“.md#åŠ å¯†å‡½æ•°) |
| HTTP | v0.30+ | 2+ | [02.3-å†…ç½®å‡½æ•°åº“](docs/02-è¯­è¨€æ¨¡å‹/02.3-å†…ç½®å‡½æ•°åº“.md#httpå‡½æ•°) |
| GraphQL | v0.45+ | 5+ | [02.3-å†…ç½®å‡½æ•°åº“](docs/02-è¯­è¨€æ¨¡å‹/02.3-å†…ç½®å‡½æ•°åº“.md#å›¾éå†) |

### ç”Ÿæ€ç³»ç»Ÿé›†æˆ

| å·¥å…·/å¹³å° | ç‰ˆæœ¬è¦æ±‚ | æµ‹è¯•ç‰ˆæœ¬ | å…¼å®¹æ€§ | æ–‡æ¡£ |
|---------|---------|---------|-------|------|
| **Kubernetes** | 1.23+ | 1.28, 1.29, 1.30 | âœ… | [04.1-Kubernetesé›†æˆ](docs/04-ç”Ÿæ€ç³»ç»Ÿ/04.1-Kubernetesé›†æˆ.md) |
| **Gatekeeper** | v3.10+ | v3.17 | âœ… | [04.2-Gatekeeperè¯¦è§£](docs/04-ç”Ÿæ€ç³»ç»Ÿ/04.2-Gatekeeperè¯¦è§£.md) |
| **Envoy** | 1.18+ | 1.31 | âœ… | [05.2-APIç½‘å…³æˆæƒ](docs/05-åº”ç”¨åœºæ™¯/05.2-APIç½‘å…³æˆæƒ.md) |
| **Istio** | 1.10+ | 1.23 | âœ… | [05.2-APIç½‘å…³æˆæƒ](docs/05-åº”ç”¨åœºæ™¯/05.2-APIç½‘å…³æˆæƒ.md) |
| **Docker** | 20.10+ | 27.x | âœ… | éƒ¨ç½²ç¤ºä¾‹ |

---

## ğŸ”„ é‡è¦ç‰ˆæœ¬å˜æ›´å†å²

### OPA v0.68.0 (2024-10)

**æ–°ç‰¹æ€§**:

- æ€§èƒ½ä¼˜åŒ–ï¼šæŸ¥è¯¢è¯„ä¼°é€Ÿåº¦æå‡15%
- æ–°å¢å†…ç½®å‡½æ•°ï¼š`crypto.x509.parse_and_verify_certificates_with_options`
- æ”¹è¿›WASMç¼–è¯‘å™¨

**å½±å“**: æœ¬æ–‡æ¡£æ‰€æœ‰ç¤ºä¾‹å·²éªŒè¯å…¼å®¹

---

### OPA v0.60.0 (2024-02)

**æ–°ç‰¹æ€§**:

- æ–°å¢ `http.send` è¶…æ—¶é…ç½®
- æ”¹è¿›éƒ¨åˆ†æ±‚å€¼æ€§èƒ½
- WASMå†…å­˜ä¼˜åŒ–

**å½±å“**: éƒ¨åˆ†æ±‚å€¼ç›¸å…³æ–‡æ¡£å·²æ›´æ–°

---

### OPA v0.55.0 (2023-08)

**æ–°ç‰¹æ€§**:

- ç¨³å®šçš„Rego v1è¯­æ³•
- æ”¹è¿›é”™è¯¯æ¶ˆæ¯
- æ€§èƒ½åŸºå‡†å·¥å…·å¢å¼º

**å½±å“**: æœ¬æ–‡æ¡£æœ€ä½æ”¯æŒç‰ˆæœ¬

**âš ï¸ é‡è¦**: v0.55ä¹‹å‰çš„ç‰ˆæœ¬å¯èƒ½ä¸æ–‡æ¡£ç¤ºä¾‹ä¸å…¼å®¹

---

### OPA v0.42.0 (2022-06) - Rego v1é‡Œç¨‹ç¢‘

**æ–°ç‰¹æ€§**:

- ğŸ‰ å¼•å…¥Rego v1è¯­æ³•
- æ–°å…³é”®å­—ï¼š`if`, `contains`, `in`, `every`
- `import rego.v1` å¯ç”¨æ–°è¯­æ³•

**å½±å“**: **æ‰€æœ‰æ–‡æ¡£ä½¿ç”¨Rego v1è¯­æ³•**

**è¿ç§»æŒ‡å—**:

```rego
# Rego v0 (æ—§è¯­æ³•)
allow = true {
    input.user == "admin"
}

# Rego v1 (æ–°è¯­æ³• - æœ¬æ–‡æ¡£ä½¿ç”¨)
import rego.v1

allow if {
    input.user == "admin"
}
```

---

## ğŸ“– æŒ‰æ–‡æ¡£çš„ç‰ˆæœ¬è¦æ±‚

### æŠ€æœ¯è§„èŒƒ

| æ–‡æ¡£ | æœ€ä½OPAç‰ˆæœ¬ | æ¨èç‰ˆæœ¬ | å…³é”®ç‰¹æ€§ |
|------|------------|---------|---------|
| [01.1-APIè§„èŒƒ](docs/01-æŠ€æœ¯è§„èŒƒ/01.1-APIè§„èŒƒ.md) | v0.10+ | v0.68+ | REST API, Health Check |
| [01.2-Bundleæ ¼å¼](docs/01-æŠ€æœ¯è§„èŒƒ/01.2-Bundleæ ¼å¼è§„èŒƒ.md) | v0.10+ | v0.68+ | Bundleç­¾åéœ€v0.20+ |
| [01.3-WASMç¼–è¯‘](docs/01-æŠ€æœ¯è§„èŒƒ/01.3-WASMç¼–è¯‘è§„èŒƒ.md) | v0.20+ | v0.68+ | ä¼˜åŒ–éœ€v0.50+ |
| [01.4-æ€§èƒ½åŸºå‡†](docs/01-æŠ€æœ¯è§„èŒƒ/01.4-æ€§èƒ½åŸºå‡†ä¸åº¦é‡.md) | v0.30+ | v0.68+ | Profilingå·¥å…· |
| [01.5-å®‰å…¨åˆè§„](docs/01-æŠ€æœ¯è§„èŒƒ/01.5-å®‰å…¨åˆè§„æ ‡å‡†.md) | v0.30+ | v0.68+ | TLS, ç­¾åéªŒè¯ |

### è¯­è¨€æ¨¡å‹

| æ–‡æ¡£ | æœ€ä½OPAç‰ˆæœ¬ | æ¨èç‰ˆæœ¬ | Regoç‰ˆæœ¬ |
|------|------------|---------|---------|
| [02.1-Regoè¯­æ³•](docs/02-è¯­è¨€æ¨¡å‹/02.1-Regoè¯­æ³•è§„èŒƒ.md) | v0.42+ | v0.68+ | v1.0 å¿…éœ€ |
| [02.2-ç±»å‹ç³»ç»Ÿ](docs/02-è¯­è¨€æ¨¡å‹/02.2-ç±»å‹ç³»ç»Ÿ.md) | v0.42+ | v0.68+ | v1.0 |
| [02.3-å†…ç½®å‡½æ•°](docs/02-è¯­è¨€æ¨¡å‹/02.3-å†…ç½®å‡½æ•°åº“.md) | v0.30+ | v0.68+ | éƒ¨åˆ†å‡½æ•°æœ‰ç‰ˆæœ¬è¦æ±‚ |
| [02.4-æ±‚å€¼æ¨¡å‹](docs/02-è¯­è¨€æ¨¡å‹/02.4-æ±‚å€¼æ¨¡å‹.md) | v0.42+ | v0.68+ | v1.0 |

### å®ç°æ¶æ„

| æ–‡æ¡£ | æœ€ä½OPAç‰ˆæœ¬ | æ¨èç‰ˆæœ¬ | è¯´æ˜ |
|------|------------|---------|------|
| [03.1-è¯æ³•è§£æ](docs/03-å®ç°æ¶æ„/03.1-è¯æ³•åˆ†æä¸è¯­æ³•è§£æ.md) | v0.42+ | v0.68+ | Rego v1è§£æå™¨ |
| [03.2-ASTä¸IR](docs/03-å®ç°æ¶æ„/03.2-ASTä¸IR.md) | v0.50+ | v0.68+ | æ–°IRå¼•å…¥v0.50 |
| [03.3-ç¼–è¯‘å™¨è®¾è®¡](docs/03-å®ç°æ¶æ„/03.3-ç¼–è¯‘å™¨è®¾è®¡.md) | v0.50+ | v0.68+ | ä¼˜åŒ–Pass |
| [03.4-æ±‚å€¼å™¨](docs/03-å®ç°æ¶æ„/03.4-Top-Downæ±‚å€¼å™¨.md) | v0.42+ | v0.68+ | - |
| [03.5-ç´¢å¼•ä¼˜åŒ–](docs/03-å®ç°æ¶æ„/03.5-ç´¢å¼•ä¸ä¼˜åŒ–.md) | v0.30+ | v0.68+ | - |
| [03.6-éƒ¨åˆ†æ±‚å€¼](docs/03-å®ç°æ¶æ„/03.6-éƒ¨åˆ†æ±‚å€¼æŠ€æœ¯.md) | v0.20+ | v0.68+ | æ€§èƒ½å…³é”® |

---

## âš ï¸ å·²çŸ¥å…¼å®¹æ€§é—®é¢˜

### 1. Rego v0 vs v1

**é—®é¢˜**: æ··ç”¨v0å’Œv1è¯­æ³•

**ç—‡çŠ¶**:

```text
rego_parse_error: unexpected keyword, must use 'if' keyword
```

**è§£å†³**:

```rego
# æ–¹æ¡ˆ1: ä½¿ç”¨Rego v1 (æ¨è)
import rego.v1

allow if {
    input.user == "admin"
}

# æ–¹æ¡ˆ2: ä½¿ç”¨æ—§è¯­æ³•
allow = true {
    input.user == "admin"
}
```

---

### 2. WASMç¼–è¯‘é™åˆ¶

**é—®é¢˜**: éƒ¨åˆ†å†…ç½®å‡½æ•°ä¸æ”¯æŒWASM

**ä¸æ”¯æŒçš„å‡½æ•°**:

- `http.send` (ç½‘ç»œI/O)
- `opa.runtime` (è¿è¡Œæ—¶ä¿¡æ¯)

**è§£å†³**: ä½¿ç”¨SDKæ³¨å…¥å¤–éƒ¨æ•°æ®

---

### 3. Kubernetesç‰ˆæœ¬

**é—®é¢˜**: K8s APIå˜åŒ–

**å½±å“**: AdmissionReview APIç‰ˆæœ¬

**è§£å†³**:

```rego
# æ”¯æŒå¤šç‰ˆæœ¬
admission.v1
admission.v1beta1
```

---

## ğŸ” ç‰ˆæœ¬æ£€æŸ¥å‘½ä»¤

### æ£€æŸ¥OPAç‰ˆæœ¬

```bash
opa version

# è¾“å‡º:
# Version: 0.68.0
# Build Commit: ...
# Build Timestamp: ...
# Build Hostname: ...
```

### æ£€æŸ¥Regoè¯­æ³•ç‰ˆæœ¬

```bash
# éªŒè¯v1è¯­æ³•
opa check --strict --format pretty policy.rego

# è½¬æ¢v0åˆ°v1
opa fmt -w --rego-v1 policy.rego
```

### æµ‹è¯•å…¼å®¹æ€§

```bash
# ä½¿ç”¨ç‰¹å®šOPAç‰ˆæœ¬æµ‹è¯•
docker run --rm -v $(pwd):/work openpolicyagent/opa:0.68.0 test /work

# æµ‹è¯•å¤šä¸ªç‰ˆæœ¬
for version in 0.55.0 0.60.0 0.68.0; do
  echo "Testing OPA $version..."
  docker run --rm -v $(pwd):/work openpolicyagent/opa:$version test /work
done
```

---

## ğŸ“… ç»´æŠ¤è®¡åˆ’

### æ£€æŸ¥å‘¨æœŸ

- **æ¯æœˆ**: æ£€æŸ¥OPAæ–°ç‰ˆæœ¬å‘å¸ƒ
- **æ¯å­£åº¦**: æ›´æ–°å…¼å®¹æ€§çŸ©é˜µ
- **é‡å¤§ç‰ˆæœ¬**: ç«‹å³è¯„ä¼°å½±å“

### æ›´æ–°æµç¨‹

1. âœ… æ£€æŸ¥OPAå‘å¸ƒè¯´æ˜
2. âœ… æµ‹è¯•æ–°ç‰ˆæœ¬ä¸æ–‡æ¡£ç¤ºä¾‹
3. âœ… æ›´æ–°å…¼å®¹æ€§çŸ©é˜µ
4. âœ… æ›´æ–°å—å½±å“æ–‡æ¡£
5. âœ… æ›´æ–°CI/CDç‰ˆæœ¬

---

## ğŸ†˜ å‡çº§æŒ‡å—

### ä»v0.4xå‡çº§åˆ°v0.68+

```bash
# 1. è½¬æ¢ä¸ºRego v1è¯­æ³•
opa fmt -w --rego-v1 *.rego

# 2. æ·»åŠ import
echo "import rego.v1" > temp.rego
cat policy.rego >> temp.rego
mv temp.rego policy.rego

# 3. è¿è¡Œæµ‹è¯•
opa test . -v

# 4. æ›´æ–°éƒ¨ç½²é…ç½®
# - æ›´æ–°Dockeré•œåƒç‰ˆæœ¬
# - æ›´æ–°Kuberneteséƒ¨ç½²YAML
```

---

## ğŸ“ è·å–å¸®åŠ©

é‡åˆ°ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼Ÿ

- ğŸ“– æŸ¥çœ‹ [FAQ](docs/FAQ.md#ç‰ˆæœ¬å…¼å®¹æ€§)
- ğŸ’¬ æé—® [GitHub Discussions](../../discussions)
- ğŸ› æŠ¥å‘Š [GitHub Issues](../../issues)
- ğŸ“§ é‚®ä»¶ [ç»´æŠ¤è€…](mailto:maintainer@example.com)

---

## ğŸ”— ç›¸å…³èµ„æº

- [OPAå‘å¸ƒè¯´æ˜](https://github.com/open-policy-agent/opa/releases)
- [Rego v1è¿ç§»æŒ‡å—](https://www.openpolicyagent.org/docs/latest/rego-v1-migration/)
- [å…¼å®¹æ€§æµ‹è¯•](https://github.com/open-policy-agent/opa/tree/main/test)

---

**æœ€åæ›´æ–°**: 2025-10-21  
**ä¸‹æ¬¡æ£€æŸ¥**: 2025-11-21  
**ç»´æŠ¤è€…**: OPAä¸­æ–‡æ–‡æ¡£å›¢é˜Ÿ
